var data = [{
    img: '1.JPG',
    caption: '那么多的美好时光',
    desc: '还是很庆幸<br>学生时候咬牙买了这相机<br>后来无数的美好瞬间<br>才有了时光的见证<br>扑面而来的回忆<br>才能绽放为嘴边的<br>会心一笑'
}, {
    img: '2.JPG',
    caption: '多多，最好的礼物',
    desc: '领证是个计划外的举措<br>没有鲜花钻戒和晚宴烛光下的承诺<br>你问我想要什么来纪念这一刻<br>我说，送我条狗吧<br>于是我们有了多多<br>也有了数不清的惊喜和惊吓<br>和一份深深的的牵挂'
}, {
    img: '3.JPG',
    caption: '两两相望',
    desc: '两两相望，<br>多么诗意的场合，<br>诗文里执手相看泪眼，<br>是看那眼底藏不住的暖和温柔，<br>为毛到了我们这里，<br>却成了看谁绷不住<br>先笑出声的无声较量?'
}, {
    img: '4.JPG',
    caption: '啊，虐了一把狗',
    desc: '你在亲吻我手背,<br>我们都忽略了,<br>多多在一旁的回眸,<br>看它那小背影隐约透出几分寂寥，<br>啊，不经意间，<br>我们活生生演绎了一把，<br>什么叫做虐狗'
}, {
    img: '5.JPG',
    caption: '多多是个拍照必杀器',
    desc: '如果忽略左下角<br>多多屁股的出镜<br>这大概会是张好片子<br>无论光影、构图还是人物的表情<br>看来，如何和宠物优雅的同框<br>真是个任重道远的命题<br>谁让多多<br>是个拍照必杀器'
}, {
    img: '6.JPG',
    caption: '这张磊少好文艺',
    desc: '下午四点的阳光<br>透过午后的树林<br>也让人物的轮廓<br>有了圈柔和的光华<br>让这位平时写代码的直男<br>透出了点朦胧的文艺小清新<br>当然，前提是你没发现<br>这位伪文艺正挖鼻孔的专注..'
}, {
    img: '7.JPG',
    caption: '婚纱照，自己DIY吧',
    desc: '我说<br>婚纱照我们自己拍吧<br>影楼流水化的作业多没劲<br>浓妆艳抹哪里还认得出自己<br>当然，最最重要的是<br>还能省下几千大洋呢哈哈哈'
}, {
    img: '8.JPG',
    caption: '花正好，人正俏',
    desc: '当我披上嫁衣<br>侧身把那花儿嗅<br>外形似还真有几分温婉贤淑<br>虽然内里十足的大逆不道<br>原来闹哄哄的日常也能岁月静好<br>比如这一刻<br>花正好,人正俏,春光也来凑热闹'
}, {
    img: '9.JPG',
    caption: '摆pos的难题',
    desc: '每次拍照<br>pos总是个难题<br>谁让磊少这个直男<br>永远千篇一律地面瘫<br>无奈将其由模特降级为道具<br>随意蹂躏下<br>居然还有几张勉强可入眼的作品<br>哈哈'
}, {
    img: '10.JPG',
    caption: '愿岁月温柔以待',
    desc: '2017这一年<br>或许并不能称不上不坏<br>那么多的努力和拼搏<br>却总缺失一份机会的垂爱<br>唯愿未来的岁月<br>所有的付出<br>都有它应得的款待<br>所有的生命<br>都能被温柔以待'
}, {
    img: '11.JPG',
    caption: '但愿人长久，狗常闹',
    desc: '有时也会抱怨职场的无力与挫败<br>和对有心无力的感慨<br>可纵有失意和无奈<br>总在推开门的那一刻<br>被多多欢扑而来的热情削减<br>无论现实如何给予人生以考验<br>请祝福我们<br>人长久,狗狗常闹'
}, {
    img: '12.JPG',
    caption: '一起卖萌吧',
    desc: 'bobo是个伪文青<br>磊少是个真直男<br>在一起纵有鸡飞狗跳<br>大部分不过细水长流<br>希望童真永不被油盐酱醋磨折<br>所以偶尔<br>一起嘟个嘴卖萌吧'
}, {
    img: '13.JPG',
    caption: '恶搞也是一种态度',
    desc: '就自拍婚纱照的风格<br>bobo和磊少有过争执<br>磊少想走端庄典雅影楼风<br>bobo想要搞怪搞笑另类风<br>并美其名曰<br>恶搞也是一种态度<br>幽默的自嘲的乐观的豁达的态度<br>嘿嘿，发现自己还真会提炼升华...'
}, {
    img: '14.JPG',
    caption: '大家来找茬',
    desc: '这是一张找茬图<br>多多的位置和表情亮了<br>瞬间压过了它爹它娘的所有风华<br>快门按下那一瞬<br>总有太多未知<br>可正如此<br>才有了出其不意的惊喜和期待'
}, {
    img: '15.JPG',
    caption: '论好照片面世的背后',
    desc: '你该减肥了<br>你该练肌肉了<br>一张公主抱照片的面世的背后<br>是两个人唇枪舌剑的彼此嘲笑<br>一直很纳闷<br>电视剧小说里<br>男主背着女主走了那么远的路程<br>莫非果真是骗人的？'
}, {
    img: '16.JPG',
    caption: '相爱的最高境界是相斗相杀',
    desc: '我不要举案齐眉<br>那太过拘谨<br>我不要相敬如宾<br>那过于客气<br>我想要的爱情<br>是可以在你面前<br>磨牙放屁打呼噜<br>时不时上演无影掌旋风腿的<br>相爱亦相杀，嘿嘿'
}];
var $gallery = $('#gallery');
//产生min与max之间的随机数
function randomRange(min, max) {
    return Math.random() * (max - min) + min;
}
//获取画廊区域的位置和坐标
function measureGallery() {
    var result = { left: {}, right: {} };
    var galleryWidth = $gallery.outerWidth();
    var galleryHeight = $gallery.outerHeight();
    var photoWidth = $('.photo').outerWidth();
    var photoHeight = $('.photo').outerHeight();
    result.left.x = [-photoWidth / 2, galleryWidth / 2 - photoWidth];
    result.right.x = [galleryWidth / 2, galleryWidth - photoWidth / 2];
    result.left.y = result.right.y = [-photoHeight / 2, galleryHeight - photoHeight / 2];
    return result;
}

//加载所有的图片元素
function renderPhoto() {
    var template = $gallery.html();
    var html = [];
    var regExp = /\{\{(\w+)\}\}/g;
    for (var index = 0; index < data.length; index++) {
        var curStr = template.replace(regExp, function(all, str1) {
            var val = data[index][str1];
            if (str1 === 'index') {
                val = index;
            } else if (val.indexOf('JPG') >= 0) {
                val = './images/2017/' + val;
            }
            return val;

        })
        html.push(curStr);
    }
    $gallery.html(html.join(''));

}
//随机分布图片的位置
//centerIndex为中间图片的索引
function layoutPhotos(centerIndex) {
    var range = measureGallery();
    var $photos = $('.photo');
    for (var index = 0, len = $photos.length; index < len; index++) {
        var $curPhoto = $photos.eq(index);
        $curPhoto.removeClass('photo-center photo-front photo-back');
        if (index !== centerIndex) {
            //随机分配在左边或者右边
            var direct = Math.random() <= 0.5 ? 'left' : 'right';
            var x = randomRange(range[direct]['x'][0], range[direct]['x'][1]);
            var y = randomRange(range[direct]['y'][0], range[direct]['y'][1]);
            var deg = randomRange(-120, 120);
            var zIndex = Math.ceil(randomRange(1, 10));
            $curPhoto.css({ 'left': x + 'px', 'top': y + 'px', 'transform': 'rotate(' + deg + 'deg)', 'z-index': zIndex });
        } else {
            $curPhoto.removeAttr('style');
            $curPhoto.addClass('photo-center');
        }
    }

}
var timeId;

function autoPlay() {
    timeId = setInterval(function() {
        centerIndex = randomRange(0, data.length - 1) | 0;
        layoutPhotos(centerIndex);
    }, 4000);
}

function stopPlay() {
    if (timeId) {
        clearInterval(timeId);
    }
}

function initEvent() {
    $gallery.on('mouseover', function() {
        stopPlay();
    });
    $gallery.on('mouseout', function() {
        autoPlay();
    });

    $gallery.on('click', '.photo', function(e) {
        var index = parseInt($(e.target).parents('.photo').attr('index'));
        if (index !== centerIndex) {
            layoutPhotos(index);
            centerIndex = index;
        } else {
            $('.photo-center').toggleClass('photo-front').toggleClass('photo-back');
        }
    });

}

renderPhoto();
var centerIndex = randomRange(0, data.length - 1) | 0;
layoutPhotos(centerIndex);
initEvent();
autoPlay();
